"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5061],{65377:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return p}});var r=n(83117),o=n(80102),a=(n(67294),n(3905)),i=["components"],s={title:"Using Entity Constructors"},l=void 0,u={unversionedId:"entity-constructors",id:"version-5.6/entity-constructors",title:"Using Entity Constructors",description:"Internally, MikroORM never calls entity constructor on managed entities (those loaded via EntityManager), so you are free to use it as you wish. The constructor will be called only when you instantiate the class yourself via new operator (or when using em.create() to create new entity instance), so it is a handy place to require your data when creating new entity.",source:"@site/versioned_docs/version-5.6/entity-constructors.md",sourceDirName:".",slug:"/entity-constructors",permalink:"/docs/entity-constructors",draft:!1,editUrl:"https://github.com/mikro-orm/mikro-orm/edit/master/docs/versioned_docs/version-5.6/entity-constructors.md",tags:[],version:"5.6",lastUpdatedBy:"Martin Ad\xe1mek",lastUpdatedAt:1671203480,formattedLastUpdatedAt:"Dec 16, 2022",frontMatter:{title:"Using Entity Constructors"},sidebar:"docs",previous:{title:"Usage with AdminJS",permalink:"/docs/usage-with-adminjs"},next:{title:"Using Multiple Schemas",permalink:"/docs/multiple-schemas"}},c={},p=[{value:"POJO vs entity instance in constructor",id:"pojo-vs-entity-instance-in-constructor",level:2},{value:"Using native private properties",id:"using-native-private-properties",level:2}],d={toc:p};function h(e){var t=e.components,n=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Internally, ",(0,a.kt)("inlineCode",{parentName:"p"},"MikroORM")," never calls entity constructor on managed entities (those loaded via ",(0,a.kt)("inlineCode",{parentName:"p"},"EntityManager"),"), so you are free to use it as you wish. The constructor will be called only when you instantiate the class yourself via ",(0,a.kt)("inlineCode",{parentName:"p"},"new")," operator (or when using ",(0,a.kt)("inlineCode",{parentName:"p"},"em.create()")," to create new entity instance), so it is a handy place to require your data when creating new entity."),(0,a.kt)("p",null,"For example following ",(0,a.kt)("inlineCode",{parentName:"p"},"Book")," entity definition will always require to set ",(0,a.kt)("inlineCode",{parentName:"p"},"title")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"author"),", but ",(0,a.kt)("inlineCode",{parentName:"p"},"publisher")," will be optional:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"@Entity()\nexport class Book {\n\n  @PrimaryKey()\n  id!: number;\n\n  @Property()\n  title: string;\n\n  @Property()\n  foo!: number;\n\n  @ManyToOne()\n  author: Author;\n\n  @ManyToOne()\n  publisher?: Publisher;\n\n  @ManyToMany({ entity: () => BookTag, inversedBy: 'books' })\n  tags = new Collection<BookTag>(this);\n\n  constructor(title: string, author: Author) {\n    this.title = title;\n    this.author = author;\n  }\n\n}\n")),(0,a.kt)("p",null,"Now you can construct your entity this way:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"const author = new Author();\nconst book = new Book('Foo', author);\n")),(0,a.kt)("p",null,"The constructor parameters will be automatically detected and respected by ",(0,a.kt)("inlineCode",{parentName:"p"},"em.create()")," too:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"const author = new Author();\nconst book = em.create(Book, { title: 'Foo', author, foo: 123 });\n")),(0,a.kt)("p",null,"This will extract ",(0,a.kt)("inlineCode",{parentName:"p"},"title")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"author")," from the data and pass it to the constructor, and assign only the rest (so here only the ",(0,a.kt)("inlineCode",{parentName:"p"},"foo")," property) to the created entity."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Constructor parameter inference works based on the entity property names. In other words, your parameters need to be called exactly the same as entity properties.")),(0,a.kt)("h2",{id:"pojo-vs-entity-instance-in-constructor"},"POJO vs entity instance in constructor"),(0,a.kt)("p",null,"It might be tempting to just define your constructor with a DTO as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"constructor(dto: { title: string; author: number }) {\n  this.title = dto.title;\n  // fails to compile, `number` is assignable not `Author`!\n  this.author = dto.author;\n}\n")),(0,a.kt)("p",null,"Similar (but more hidden) problem would appear if your ",(0,a.kt)("inlineCode",{parentName:"p"},"dto.author")," was a POJO (so an object, but not an instance of the ",(0,a.kt)("inlineCode",{parentName:"p"},"Author")," entity), as that might type check, although it won't work either. The ORM expects entity instances in relation properties, nothing else."),(0,a.kt)("p",null,"But worry not, since v5.6 there is an easy way to convert a primary key to the entity reference, the ",(0,a.kt)("inlineCode",{parentName:"p"},"rel()")," helper:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"@ManyToOne({ entity: () => Author })\nauthor: Rel<Author>;\n\nconstructor(dto: { title: string; author: number }) {\n  this.title = dto.title;\n  this.author = rel(Author, dto.author);\n}\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"rel()")," helper will create entity instance that is not yet managed (as we don't pass it any ",(0,a.kt)("inlineCode",{parentName:"p"},"EntityManager")," instance), but it will be considered as existing entity reference once it becomes managed. This is in fact an equivalent to ",(0,a.kt)("inlineCode",{parentName:"p"},"em.getReference()"),", but without having the ",(0,a.kt)("inlineCode",{parentName:"p"},"EntityManager")," instance at hand."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"rel()")," is a shortcut for ",(0,a.kt)("inlineCode",{parentName:"p"},"Reference.createNakedFromPK()"),".")),(0,a.kt)("p",null,"And if you want to be safer and use the ",(0,a.kt)("inlineCode",{parentName:"p"},"Reference")," wrapper, the ",(0,a.kt)("inlineCode",{parentName:"p"},"ref()")," helper also accepts this new signature: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"@ManyToOne({ entity: () => Author, ref: true })\nauthor: Ref<Author>;\n\nconstructor(dto: { title: string; author: number }) {\n  this.title = dto.title;\n  this.author = ref(Author, dto.author);\n}\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"rel")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"ref")," helpers will accept both primary key and entity instance, as well as empty value (",(0,a.kt)("inlineCode",{parentName:"p"},"null")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"undefined"),")."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"book.author = ref(Author, null);\nbook.author = ref(Author, undefined);\nbook.author = ref(null);\nbook.author = ref(undefined);\nbook.author = ref(Author, 1);\nbook.author = ref(Author, author);\nbook.author = ref(author);\n")),(0,a.kt)("h2",{id:"using-native-private-properties"},"Using native private properties"),(0,a.kt)("p",null,"If you want to use native private properties inside entities, the default approach of how MikroORM creates entity instances via ",(0,a.kt)("inlineCode",{parentName:"p"},"Object.create()")," is not viable (more about this in the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/mikro-orm/mikro-orm/issues/1226"},"issue"),"). To force usage of entity constructors, you can use ",(0,a.kt)("a",{parentName:"p",href:"/docs/configuration#using-native-private-properties"},(0,a.kt)("inlineCode",{parentName:"a"},"forceEntityConstructor"))," toggle."))}h.isMDXComponent=!0},3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(n),h=o,m=d["".concat(l,".").concat(h)]||d[h]||p[h]||a;return n?r.createElement(m,i(i({ref:t},c),{},{components:n})):r.createElement(m,i({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var u=2;u<a;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);